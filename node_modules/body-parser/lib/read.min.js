function read(a,b,c,d,e,f){var g,h;a._body=!0;var i=f||{};try{h=contentstream(a,e,i.inflate),g=h.length,delete h.length}catch(j){return c(j)}i.length=g;var k=null!==i.encoding?i.encoding||"utf-8":null,l=i.verify;i.encoding=l?null:k,e("read body"),getBody(h,i,function(f,g){if(f)return f.status||(f.status=400),"encoding.unsupported"===f.type&&(f=new Error('unsupported charset "'+k.toUpperCase()+'"'),f.charset=k.toLowerCase(),f.status=415),h.resume(),void onFinished(a,function(){c(f)});if(l)try{e("verify body"),l(a,b,g,k)}catch(f){return f.status||(f.status=403),c(f)}try{e("parse body"),g="string"!=typeof g&&null!==k?iconv.decode(g,k):g,a.body=d(g)}catch(f){return f.status||(f.body=g,f.status=400),c(f)}c()})}function contentstream(a,b,c){var d,e,f=(a.headers["content-encoding"]||"identity").toLowerCase(),g=a.headers["content-length"];if(b('content-encoding "%s"',f),c===!1&&"identity"!==f)throw d=new Error("content encoding unsupported"),d.status=415,d;switch(f){case"deflate":e=zlib.createInflate(),b("inflate body"),a.pipe(e);break;case"gzip":e=zlib.createGunzip(),b("gunzip body"),a.pipe(e);break;case"identity":e=a,e.length=g;break;default:throw d=new Error('unsupported content encoding "'+f+'"'),d.encoding=f,d.status=415,d}return e}var getBody=require("raw-body"),iconv=require("iconv-lite"),onFinished=require("on-finished"),zlib=require("zlib");module.exports=read;