function json(a){function b(a){if(0===a.length)return{};if(f){var b=firstchar(a);if("{"!==b&&"["!==b)throw debug("strict violation"),new Error("invalid json")}return debug("parse json"),JSON.parse(a,e)}a=a||{};var c="number"!=typeof a.limit?bytes(a.limit||"100kb"):a.limit,d=a.inflate!==!1,e=a.reviver,f=a.strict!==!1,g=a.type||"json",h=a.verify||!1;if(h!==!1&&"function"!=typeof h)throw new TypeError("option verify must be function");var i="function"!=typeof g?typeChecker(g):g;return function(a,e,f){if(a._body)return debug("body already parsed"),f();if(a.body=a.body||{},!typeis.hasBody(a))return debug("skip empty body"),f();if(debug("content-type %j",a.headers["content-type"]),!i(a))return debug("skip parsing"),f();var g=getCharset(a)||"utf-8";if("utf-"!==g.substr(0,4)){var j=new Error('unsupported charset "'+g.toUpperCase()+'"');return j.charset=g,j.status=415,debug("invalid charset"),f(j)}read(a,e,f,b,debug,{encoding:g,inflate:d,limit:c,verify:h})}}function firstchar(a){var b=firstcharRegExp.exec(a);return b?b[1]:""}function getCharset(a){try{return contentType.parse(a).parameters.charset.toLowerCase()}catch(b){return void 0}}function typeChecker(a){return function(b){return Boolean(typeis(b,a))}}var bytes=require("bytes"),contentType=require("content-type"),debug=require("debug")("body-parser:json"),read=require("../read"),typeis=require("type-is");module.exports=json;var firstcharRegExp=/^[\x20\x09\x0a\x0d]*(.)/;