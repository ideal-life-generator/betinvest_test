function DBCSCodec(a){if(this.options=a,!a)throw new Error("DBCS codec is called without the data.");if(!a.table)throw new Error("Encoding '"+a.encodingName+"' has no data.");var b=a.table();this.decodeTables=[],this.decodeTables[0]=UNASSIGNED_NODE.slice(0),this.decodeTableSeq=[];for(var c=0;c<b.length;c++)this._addDecodeChunk(b[c]);this.defaultCharUnicode=a.iconv.defaultCharUnicode,this.encodeTable=[],this.encodeTableSeq=[];var d={};if(a.encodeSkipVals)for(var c=0;c<a.encodeSkipVals.length;c++)for(var e=a.encodeSkipVals[c],f=e.from;f<=e.to;f++)d[f]=!0;if(this._fillEncodeTable(0,0,d),a.encodeAdd)for(var g in a.encodeAdd)Object.prototype.hasOwnProperty.call(a.encodeAdd,g)&&this._setEncodeChar(g.charCodeAt(0),a.encodeAdd[g]);if(this.defCharSB=this.encodeTable[0][a.iconv.defaultCharSingleByte.charCodeAt(0)],this.defCharSB===UNASSIGNED&&(this.defCharSB=this.encodeTable[0]["?"]),this.defCharSB===UNASSIGNED&&(this.defCharSB="?".charCodeAt(0)),"function"==typeof a.gb18030){this.gb18030=a.gb18030();for(var h=this.decodeTables.length,i=this.decodeTables[h]=UNASSIGNED_NODE.slice(0),j=this.decodeTables.length,k=this.decodeTables[j]=UNASSIGNED_NODE.slice(0),c=129;254>=c;c++)for(var l=NODE_START-this.decodeTables[0][c],m=this.decodeTables[l],f=48;57>=f;f++)m[f]=NODE_START-h;for(var c=129;254>=c;c++)i[c]=NODE_START-j;for(var c=48;57>=c;c++)k[c]=GB18030_CODE}}function encoderDBCSWrite(a){for(var b=new Buffer(a.length*(this.gb18030?4:3)),c=this.leadSurrogate,d=this.seqObj,e=-1,f=0,g=0;;){if(-1===e){if(f==a.length)break;var h=a.charCodeAt(f++)}else{var h=e;e=-1}if(h>=55296&&57344>h)if(56320>h){if(-1===c){c=h;continue}c=h,h=UNASSIGNED}else-1!==c?(h=65536+1024*(c-55296)+(h-56320),c=-1):h=UNASSIGNED;else-1!==c&&(e=h,h=UNASSIGNED,c=-1);var i=UNASSIGNED;if(void 0!==d&&h!=UNASSIGNED){var j=d[h];if("object"==typeof j){d=j;continue}"number"==typeof j?i=j:void 0==j&&(j=d[DEF_CHAR],void 0!==j&&(i=j,e=h)),d=void 0}else if(h>=0){var k=this.encodeTable[h>>8];if(void 0!==k&&(i=k[255&h]),SEQ_START>=i){d=this.encodeTableSeq[SEQ_START-i];continue}if(i==UNASSIGNED&&this.gb18030){var l=findIdx(this.gb18030.uChars,h);if(-1!=l){var i=this.gb18030.gbChars[l]+(h-this.gb18030.uChars[l]);b[g++]=129+Math.floor(i/12600),i%=12600,b[g++]=48+Math.floor(i/1260),i%=1260,b[g++]=129+Math.floor(i/10),i%=10,b[g++]=48+i;continue}}}i===UNASSIGNED&&(i=this.defaultCharSingleByte),256>i?b[g++]=i:65536>i?(b[g++]=i>>8,b[g++]=255&i):(b[g++]=i>>16,b[g++]=i>>8&255,b[g++]=255&i)}return this.seqObj=d,this.leadSurrogate=c,b.slice(0,g)}function encoderDBCSEnd(){if(-1!==this.leadSurrogate||void 0!==this.seqObj){var a=new Buffer(10),b=0;if(this.seqObj){var c=this.seqObj[DEF_CHAR];void 0!==c&&(256>c?a[b++]=c:(a[b++]=c>>8,a[b++]=255&c)),this.seqObj=void 0}return-1!==this.leadSurrogate&&(a[b++]=this.defaultCharSingleByte,this.leadSurrogate=-1),a.slice(0,b)}}function decoderDBCSWrite(a){var b,c=new Buffer(2*a.length),d=this.nodeIdx,e=this.prevBuf,f=this.prevBuf.length,g=-this.prevBuf.length;f>0&&(e=Buffer.concat([e,a.slice(0,10)]));for(var h=0,i=0;h<a.length;h++){var j=h>=0?a[h]:e[h+f],b=this.decodeTables[d][j];if(b>=0);else if(b===UNASSIGNED)h=g,b=this.defaultCharUnicode.charCodeAt(0);else if(b===GB18030_CODE){var k=g>=0?a.slice(g,h+1):e.slice(g+f,h+1+f),l=12600*(k[0]-129)+1260*(k[1]-48)+10*(k[2]-129)+(k[3]-48),m=findIdx(this.gb18030.gbChars,l);b=this.gb18030.uChars[m]+l-this.gb18030.gbChars[m]}else{if(NODE_START>=b){d=NODE_START-b;continue}if(!(SEQ_START>=b))throw new Error("iconv-lite internal error: invalid decoding table value "+b+" at "+d+"/"+j);for(var n=this.decodeTableSeq[SEQ_START-b],o=0;o<n.length-1;o++)b=n[o],c[i++]=255&b,c[i++]=b>>8;b=n[n.length-1]}if(b>65535){b-=65536;var p=55296+Math.floor(b/1024);c[i++]=255&p,c[i++]=p>>8,b=56320+b%1024}c[i++]=255&b,c[i++]=b>>8,d=0,g=h+1}return this.nodeIdx=d,this.prevBuf=g>=0?a.slice(g):e.slice(g+f),c.slice(0,i).toString("ucs2")}function decoderDBCSEnd(){for(var a="";this.prevBuf.length>0;){a+=this.defaultCharUnicode;var b=this.prevBuf.slice(1);this.prevBuf=new Buffer(0),this.nodeIdx=0,b.length>0&&(a+=decoderDBCSWrite.call(this,b))}return this.nodeIdx=0,a}function findIdx(a,b){if(a[0]>b)return-1;for(var c=0,d=a.length;d-1>c;){var e=c+Math.floor((d-c+1)/2);a[e]<=b?c=e:d=e}return c}exports._dbcs=function(a){return new DBCSCodec(a)};for(var UNASSIGNED=-1,GB18030_CODE=-2,SEQ_START=-10,NODE_START=-1e3,UNASSIGNED_NODE=new Array(256),DEF_CHAR=-1,i=0;256>i;i++)UNASSIGNED_NODE[i]=UNASSIGNED;DBCSCodec.prototype.encoder=function(a){return{write:encoderDBCSWrite,end:encoderDBCSEnd,leadSurrogate:-1,seqObj:void 0,encodeTable:this.encodeTable,encodeTableSeq:this.encodeTableSeq,defaultCharSingleByte:this.defCharSB,gb18030:this.gb18030,findIdx:findIdx}},DBCSCodec.prototype.decoder=function(a){return{write:decoderDBCSWrite,end:decoderDBCSEnd,nodeIdx:0,prevBuf:new Buffer(0),decodeTables:this.decodeTables,decodeTableSeq:this.decodeTableSeq,defaultCharUnicode:this.defaultCharUnicode,gb18030:this.gb18030}},DBCSCodec.prototype._getDecodeTrieNode=function(a){for(var b=[];a>0;a>>=8)b.push(255&a);0==b.length&&b.push(0);for(var c=this.decodeTables[0],d=b.length-1;d>0;d--){var e=c[b[d]];if(e==UNASSIGNED)c[b[d]]=NODE_START-this.decodeTables.length,this.decodeTables.push(c=UNASSIGNED_NODE.slice(0));else{if(!(NODE_START>=e))throw new Error("Overwrite byte in "+this.options.encodingName+", addr: "+a.toString(16));c=this.decodeTables[NODE_START-e]}}return c},DBCSCodec.prototype._addDecodeChunk=function(a){var b=parseInt(a[0],16),c=this._getDecodeTrieNode(b);b=255&b;for(var d=1;d<a.length;d++){var e=a[d];if("string"==typeof e)for(var f=0;f<e.length;){var g=e.charCodeAt(f++);if(g>=55296&&56320>g){var h=e.charCodeAt(f++);if(!(h>=56320&&57344>h))throw new Error("Incorrect surrogate pair in "+this.options.encodingName+" at chunk "+a[0]);c[b++]=65536+1024*(g-55296)+(h-56320)}else if(g>4080&&4095>=g){for(var i=4095-g+2,j=[],k=0;i>k;k++)j.push(e.charCodeAt(f++));c[b++]=SEQ_START-this.decodeTableSeq.length,this.decodeTableSeq.push(j)}else c[b++]=g}else{if("number"!=typeof e)throw new Error("Incorrect type '"+typeof e+"' given in "+this.options.encodingName+" at chunk "+a[0]);for(var l=c[b-1]+1,f=0;e>f;f++)c[b++]=l++}}if(b>255)throw new Error("Incorrect chunk in "+this.options.encodingName+" at addr "+a[0]+": too long"+b)},DBCSCodec.prototype._getEncodeBucket=function(a){var b=a>>8;return void 0===this.encodeTable[b]&&(this.encodeTable[b]=UNASSIGNED_NODE.slice(0)),this.encodeTable[b]},DBCSCodec.prototype._setEncodeChar=function(a,b){var c=this._getEncodeBucket(a),d=255&a;c[d]<=SEQ_START?this.encodeTableSeq[SEQ_START-c[d]][DEF_CHAR]=b:c[d]==UNASSIGNED&&(c[d]=b)},DBCSCodec.prototype._setEncodeSequence=function(a,b){var c,d=a[0],e=this._getEncodeBucket(d),f=255&d;e[f]<=SEQ_START?c=this.encodeTableSeq[SEQ_START-e[f]]:(c={},e[f]!==UNASSIGNED&&(c[DEF_CHAR]=e[f]),e[f]=SEQ_START-this.encodeTableSeq.length,this.encodeTableSeq.push(c));for(var g=1;g<a.length-1;g++){var h=c[d];"object"==typeof h?c=h:(c=c[d]={},void 0!==h&&(c[DEF_CHAR]=h))}d=a[a.length-1],c[d]=b},DBCSCodec.prototype._fillEncodeTable=function(a,b,c){for(var d=this.decodeTables[a],e=0;256>e;e++){var f=d[e],g=b+e;c[g]||(f>=0?this._setEncodeChar(f,g):NODE_START>=f?this._fillEncodeTable(NODE_START-f,g<<8,c):SEQ_START>=f&&this._setEncodeSequence(this.decodeTableSeq[SEQ_START-f],g))}};