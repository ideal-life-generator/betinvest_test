function utf7EncoderWrite(a){return new Buffer(a.replace(nonDirectChars,function(a){return"+"+("+"===a?"":this.iconv.encode(a,"utf16-be").toString("base64").replace(/=+$/,""))+"-"}.bind(this)))}function utf7DecoderWrite(a){for(var b="",c=0,d=this.inBase64,e=this.base64Accum,f=0;f<a.length;f++)if(d){if(!base64Chars[a[f]]){if(f==c&&a[f]==minusChar)b+="+";else{var g=e+a.slice(c,f).toString();b+=this.iconv.decode(new Buffer(g,"base64"),"utf16-be")}a[f]!=minusChar&&f--,c=f+1,d=!1,e=""}}else a[f]==plusChar&&(b+=this.iconv.decode(a.slice(c,f),"ascii"),c=f+1,d=!0);if(d){var g=e+a.slice(c).toString(),h=g.length-g.length%8;e=g.slice(h),g=g.slice(0,h),b+=this.iconv.decode(new Buffer(g,"base64"),"utf16-be")}else b+=this.iconv.decode(a.slice(c),"ascii");return this.inBase64=d,this.base64Accum=e,b}function utf7DecoderEnd(){var a="";return this.inBase64&&this.base64Accum.length>0&&(a=this.iconv.decode(new Buffer(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",a}function utf7ImapEncoderWrite(a){for(var b=this.inBase64,c=this.base64Accum,d=this.base64AccumIdx,e=new Buffer(5*a.length+10),f=0,g=0;g<a.length;g++){var h=a.charCodeAt(g);h>=32&&126>=h?(b&&(d>0&&(f+=e.write(c.slice(0,d).toString("base64").replace(/\//g,",").replace(/=+$/,""),f),d=0),e[f++]=minusChar,b=!1),b||(e[f++]=h,h===andChar&&(e[f++]=minusChar))):(b||(e[f++]=andChar,b=!0),b&&(c[d++]=h>>8,c[d++]=255&h,d==c.length&&(f+=e.write(c.toString("base64").replace(/\//g,","),f),d=0)))}return this.inBase64=b,this.base64AccumIdx=d,e.slice(0,f)}function utf7ImapEncoderEnd(){var a=new Buffer(10),b=0;return this.inBase64&&(this.base64AccumIdx>0&&(b+=a.write(this.base64Accum.slice(0,this.base64AccumIdx).toString("base64").replace(/\//g,",").replace(/=+$/,""),b),this.base64AccumIdx=0),a[b++]=minusChar,this.inBase64=!1),a.slice(0,b)}function utf7ImapDecoderWrite(a){for(var b="",c=0,d=this.inBase64,e=this.base64Accum,f=0;f<a.length;f++)if(d){if(!base64IMAPChars[a[f]]){if(f==c&&a[f]==minusChar)b+="&";else{var g=e+a.slice(c,f).toString().replace(/,/g,"/");b+=this.iconv.decode(new Buffer(g,"base64"),"utf16-be")}a[f]!=minusChar&&f--,c=f+1,d=!1,e=""}}else a[f]==andChar&&(b+=this.iconv.decode(a.slice(c,f),"ascii"),c=f+1,d=!0);if(d){var g=e+a.slice(c).toString().replace(/,/g,"/"),h=g.length-g.length%8;e=g.slice(h),g=g.slice(0,h),b+=this.iconv.decode(new Buffer(g,"base64"),"utf16-be")}else b+=this.iconv.decode(a.slice(c),"ascii");return this.inBase64=d,this.base64Accum=e,b}function utf7ImapDecoderEnd(){var a="";return this.inBase64&&this.base64Accum.length>0&&(a=this.iconv.decode(new Buffer(this.base64Accum,"base64"),"utf16-be")),this.inBase64=!1,this.base64Accum="",a}exports.utf7=function(a){return{encoder:function(){return{write:utf7EncoderWrite,end:function(){},iconv:a.iconv}},decoder:function(){return{write:utf7DecoderWrite,end:utf7DecoderEnd,iconv:a.iconv,inBase64:!1,base64Accum:""}}}},exports.unicode11utf7="utf7";for(var nonDirectChars=/[^A-Za-z0-9'\(\),-\.\/:\? \n\r\t]+/g,base64Regex=/[A-Za-z0-9\/+]/,base64Chars=[],i=0;256>i;i++)base64Chars[i]=base64Regex.test(String.fromCharCode(i));var plusChar="+".charCodeAt(0),minusChar="-".charCodeAt(0),andChar="&".charCodeAt(0);exports.utf7imap=function(a){return{encoder:function(){return{write:utf7ImapEncoderWrite,end:utf7ImapEncoderEnd,iconv:a.iconv,inBase64:!1,base64Accum:new Buffer(6),base64AccumIdx:0}},decoder:function(){return{write:utf7ImapDecoderWrite,end:utf7ImapDecoderEnd,iconv:a.iconv,inBase64:!1,base64Accum:""}}}};var base64IMAPChars=base64Chars.slice();base64IMAPChars[",".charCodeAt(0)]=!0;