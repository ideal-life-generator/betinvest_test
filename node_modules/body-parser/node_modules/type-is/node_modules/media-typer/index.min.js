function format(a){if(!a||"object"!=typeof a)throw new TypeError("argument obj is required");var b=a.parameters,c=a.subtype,d=a.suffix,e=a.type;if(!e||!typeNameRegExp.test(e))throw new TypeError("invalid type");if(!c||!subtypeNameRegExp.test(c))throw new TypeError("invalid subtype");var f=e+"/"+c;if(d){if(!typeNameRegExp.test(d))throw new TypeError("invalid suffix");f+="+"+d}if(b&&"object"==typeof b)for(var g,h=Object.keys(b).sort(),i=0;i<h.length;i++){if(g=h[i],!tokenRegExp.test(g))throw new TypeError("invalid parameter name");f+="; "+g+"="+qstring(b[g])}return f}function parse(a){if(!a)throw new TypeError("argument string is required");if("object"==typeof a&&(a=getcontenttype(a)),"string"!=typeof a)throw new TypeError("argument string is required to be a string");var b,c,d,e=a.indexOf(";"),f=-1!==e?a.substr(0,e):a,g=splitType(f),h={};for(paramRegExp.lastIndex=e;c=paramRegExp.exec(a);){if(c.index!==e)throw new TypeError("invalid parameter format");e+=c[0].length,b=c[1].toLowerCase(),d=c[2],'"'===d[0]&&(d=d.substr(1,d.length-2).replace(qescRegExp,"$1")),h[b]=d}if(-1!==e&&e!==a.length)throw new TypeError("invalid parameter format");return g.parameters=h,g}function getcontenttype(a){return"function"==typeof a.getHeader?a.getHeader("content-type"):"object"==typeof a.headers?a.headers&&a.headers["content-type"]:void 0}function qstring(a){var b=String(a);if(tokenRegExp.test(b))return b;if(b.length>0&&!textRegExp.test(b))throw new TypeError("invalid parameter value");return'"'+b.replace(quoteRegExp,"\\$1")+'"'}function splitType(a){var b=typeRegExp.exec(a.toLowerCase());if(!b)throw new TypeError("invalid media type");var c,d=b[1],e=b[2],f=e.lastIndexOf("+");-1!==f&&(c=e.substr(f+1),e=e.substr(0,f));var g={type:d,subtype:e,suffix:c};return g}var paramRegExp=/; *([!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) *= *("(?:[ !\u0023-\u005b\u005d-\u007e\u0080-\u00ff]|\\[\u0020-\u007e])*"|[!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+) */g,textRegExp=/^[\u0020-\u007e\u0080-\u00ff]+$/,tokenRegExp=/^[!#$%&'\*\+\-\.0-9A-Z\^_`a-z\|~]+$/,qescRegExp=/\\([\u0000-\u007f])/g,quoteRegExp=/([\\"])/g,subtypeNameRegExp=/^[A-Za-z0-9][A-Za-z0-9!#$&^_.-]{0,126}$/,typeNameRegExp=/^[A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126}$/,typeRegExp=/^ *([A-Za-z0-9][A-Za-z0-9!#$&^_-]{0,126})\/([A-Za-z0-9][A-Za-z0-9!#$&^_.+-]{0,126}) *$/;exports.format=format,exports.parse=parse;