function parseAcceptCharset(a){for(var b=a.split(","),c=0,d=0;c<b.length;c++){var e=parseCharset(b[c].trim(),c);e&&(b[d++]=e)}return b.length=d,b}function parseCharset(a,b){var c=a.match(/^\s*(\S+?)\s*(?:;(.*))?$/);if(!c)return null;var d=c[1],e=1;if(c[2])for(var f=c[2].split(";"),b=0;b<f.length;b++){var g=f[b].trim().split("=");if("q"===g[0]){e=parseFloat(g[1]);break}}return{charset:d,q:e,i:b}}function getCharsetPriority(a,b,c){for(var d={o:-1,q:0,s:0},e=0;e<b.length;e++){var f=specify(a,b[e],c);f&&(d.s-f.s||d.q-f.q||d.o-f.o)<0&&(d=f)}return d}function specify(a,b,c){var d=0;if(b.charset.toLowerCase()===a.toLowerCase())d|=1;else if("*"!==b.charset)return null;return{i:c,o:b.i,q:b.q,s:d}}function preferredCharsets(a,b){var c=parseAcceptCharset(void 0===a?"*":a||"");if(!b)return c.filter(isQuality).sort(compareSpecs).map(function(a){return a.charset});var d=b.map(function(a,b){return getCharsetPriority(a,c,b)});return d.filter(isQuality).sort(compareSpecs).map(function(a){return b[d.indexOf(a)]})}function compareSpecs(a,b){return b.q-a.q||b.s-a.s||a.o-b.o||a.i-b.i||0}function isQuality(a){return a.q>0}module.exports=preferredCharsets,preferredCharsets.preferredCharsets=preferredCharsets;