function parseAcceptLanguage(a){for(var b=a.split(","),c=0,d=0;c<b.length;c++){var e=parseLanguage(b[c].trim(),c);e&&(b[d++]=e)}return b.length=d,b}function parseLanguage(a,b){var c=a.match(/^\s*(\S+?)(?:-(\S+?))?\s*(?:;(.*))?$/);if(!c)return null;var d=c[1],e=c[2],f=d;e&&(f+="-"+e);var g=1;if(c[3])for(var h=c[3].split(";"),b=0;b<h.length;b++){var i=h[b].split("=");"q"===i[0]&&(g=parseFloat(i[1]))}return{prefix:d,suffix:e,q:g,i:b,full:f}}function getLanguagePriority(a,b,c){for(var d={o:-1,q:0,s:0},e=0;e<b.length;e++){var f=specify(a,b[e],c);f&&(d.s-f.s||d.q-f.q||d.o-f.o)<0&&(d=f)}return d}function specify(a,b,c){var d=parseLanguage(a);if(!d)return null;var e=0;if(b.full.toLowerCase()===d.full.toLowerCase())e|=4;else if(b.prefix.toLowerCase()===d.full.toLowerCase())e|=2;else if(b.full.toLowerCase()===d.prefix.toLowerCase())e|=1;else if("*"!==b.full)return null;return{i:c,o:b.i,q:b.q,s:e}}function preferredLanguages(a,b){var c=parseAcceptLanguage(void 0===a?"*":a||"");if(!b)return c.filter(isQuality).sort(compareSpecs).map(function(a){return a.full});var d=b.map(function(a,b){return getLanguagePriority(a,c,b)});return d.filter(isQuality).sort(compareSpecs).map(function(a){return b[d.indexOf(a)]})}function compareSpecs(a,b){return b.q-a.q||b.s-a.s||a.o-b.o||a.i-b.i||0}function isQuality(a){return a.q>0}module.exports=preferredLanguages,preferredLanguages.preferredLanguages=preferredLanguages;