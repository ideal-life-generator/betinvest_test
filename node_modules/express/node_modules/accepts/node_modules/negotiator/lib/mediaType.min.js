function parseAccept(a){for(var b=a.split(","),c=0,d=0;c<b.length;c++){var e=parseMediaType(b[c].trim(),c);e&&(b[d++]=e)}return b.length=d,b}function parseMediaType(a,b){var c=a.match(/\s*(\S+?)\/([^;\s]+)\s*(?:;(.*))?/);if(!c)return null;var d=c[1],e=c[2],f=""+d+"/"+e,g={},h=1;return c[3]&&(g=c[3].split(";").map(function(a){return a.trim().split("=")}).reduce(function(a,b){return a[b[0]]=b[1],a},g),null!=g.q&&(h=parseFloat(g.q),delete g.q)),{type:d,subtype:e,params:g,q:h,i:b,full:f}}function getMediaTypePriority(a,b,c){for(var d={o:-1,q:0,s:0},e=0;e<b.length;e++){var f=specify(a,b[e],c);f&&(d.s-f.s||d.q-f.q||d.o-f.o)<0&&(d=f)}return d}function specify(a,b,c){var d=parseMediaType(a),e=0;if(!d)return null;if(b.type.toLowerCase()==d.type.toLowerCase())e|=4;else if("*"!=b.type)return null;if(b.subtype.toLowerCase()==d.subtype.toLowerCase())e|=2;else if("*"!=b.subtype)return null;var f=Object.keys(b.params);if(f.length>0){if(!f.every(function(a){return"*"==b.params[a]||(b.params[a]||"").toLowerCase()==(d.params[a]||"").toLowerCase()}))return null;e|=1}return{i:c,o:b.i,q:b.q,s:e}}function preferredMediaTypes(a,b){var c=parseAccept(void 0===a?"*/*":a||"");if(!b)return c.filter(isQuality).sort(compareSpecs).map(function(a){return a.full});var d=b.map(function(a,b){return getMediaTypePriority(a,c,b)});return d.filter(isQuality).sort(compareSpecs).map(function(a){return b[d.indexOf(a)]})}function compareSpecs(a,b){return b.q-a.q||b.s-a.s||a.o-b.o||a.i-b.i||0}function isQuality(a){return a.q>0}module.exports=preferredMediaTypes,preferredMediaTypes.preferredMediaTypes=preferredMediaTypes;